/*
	Leaflet.draw, a plugin that adds drawing and editing tools to Leaflet powered maps.
	(c) 2012-2013, Jacob Toye, Smartrak

	https://github.com/Leaflet/Leaflet.draw
	http://leafletjs.com
	https://github.com/jacobtoye
*/
!function(){L.drawVersion="0.2.3-dev",L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes.",text:"Save"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}},L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e),this._uneditedLayerProps={}},enable:function(){this._enabled||(this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type}),L.Handler.prototype.enable.call(this))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},_backupLayer:function(t){var e=t.layer||t.target||t,i=L.Util.stamp(e);return e instanceof L.FeatureGroup?e.eachLayer(this._backupLayer,this):(this._uneditedLayerProps[i]||(e instanceof L.Polyline||e instanceof L.Polygon||e instanceof L.Rectangle?(this._uneditedLayerProps[i]={latlngs:L.LatLngUtil.cloneLatLngs(e.getLatLngs())},e._icon&&(this._uneditedLayerProps[i].iconLatLng=L.LatLngUtil.cloneLatLng(e._icon.getLatLng()),this._uneditedLayerProps[i].width=e._icon.width,this._uneditedLayerProps[i].height=e._icon.height,this._uneditedLayerProps[i].fullscreen=e._icon.fullscreen,this._uneditedLayerProps[i].minzoom=e._icon.minzoom,this._uneditedLayerProps[i].maxzoom=e._icon.maxzoom,this._uneditedLayerProps[i]._interface=e._icon._interface)):e instanceof L.Circle?this._uneditedLayerProps[i]={latlng:L.LatLngUtil.cloneLatLng(e.getLatLng()),radius:e.getRadius()}:e instanceof L.Marker&&(this._uneditedLayerProps[i]={latlng:L.LatLngUtil.cloneLatLng(e.getLatLng())})),void 0)},_revertLayer:function(t){var e=L.Util.stamp(t);return t instanceof L.FeatureGroup?t.eachLayer(this._revertLayer,this):(t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?(t.setLatLngs(this._uneditedLayerProps[e].latlngs),t._icon&&(t._icon.setLatLng(this._uneditedLayerProps[e].iconLatLng),t._icon.width=this._uneditedLayerProps[e].width,t._icon.height=this._uneditedLayerProps[e].height,t._icon.fullscreen=this._uneditedLayerProps[e].fullscreen,t._icon.minzoom=this._uneditedLayerProps[e].minzoom,t._icon.maxzoom=this._uneditedLayerProps[e].maxzoom,t._icon._interface=this._uneditedLayerProps[e]._interface)):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof L.Marker&&t.setLatLng(this._uneditedLayerProps[e].latlng)),void 0)},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this),this._map.on("save",this.save,this),this._map.on("cancel",this.cancel,this),this._map.on("cancelOne",this.deleteLastVertex,this))},removeHooks:function(){this._map&&(this._map.off("save",this.save,this),this._map.off("cancel",this.cancel,this),this._map.off("cancelOne",this.deleteLastVertex,this),L.DomUtil.enableTextSelection(),L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this),this._uneditedLayerProps={})},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&this.disable()}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3},initialize:function(t,e,i,a){this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,this.globalDrawLayer=i,this.drawLayer=L.featureGroup(),this.editedLayers=L.layerGroup(),this.panel=e.panel,this.defaultProperties=a&&a.line,L.Draw.Feature.prototype.initialize.call(this,t,e);var o=this;this._map.on("polyDragStart",function(){o._enabled&&o._map.off("click",o._onClick,o)}),this._map.on("polyDragEnd",function(){o._enabled&&setTimeout(function(){o._map.on("click",o._onClick,o)},0)})},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this.globalDrawLayer.on("layeradd",this._enableLayerEdit,this),this._map&&(this.backup(),this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this.panel.updateToolTip(this._getTooltipText().text),this.panel.show(!0),this._map._container.style.cursor="crosshair",this._map.on("click",this._onClick,this),this._map.on("mousemove",this._onMouseMove,this).on("zoomend",this._onZoomEnd,this))},backup:function(){var t=this;this.globalDrawLayer.eachLayer(function(e){t._enableLayerEdit(e)})},_enableLayerEdit:function(t){var e=t.layer||t;this._backupLayer(e)},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._clearGuides(),this._map.off("mousemove",this._onMouseMove,this).off("zoomend",this._onZoomEnd,this).off("click",this._onClick,this),this._map._container.style.cursor=null,this.save(),this.globalDrawLayer.off("layeradd",this._enableLayerEdit,this),this.panel.hide()},deleteLastVertex:function(){if(0!==this._markers.length){if(1===this._markers.length)return this.removeHooks(),this.addHooks(),void 0;var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._markers.length;return e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?(this._showErrorTooltip(),void 0):(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0),void 0)},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);return!this.options.allowIntersection&&t||!this._shapeIsValid()?(this._showErrorTooltip(),void 0):(this._fireCreatedEvent(),this.options.repeatMode?(this._clearHideErrorTimeout(),this._cleanUpShape(),this._markerGroup.clearLayers(),this._map.removeLayer(this._poly),this._clearGuides(),this._markers=[],this._poly=new L.Polyline([],this.options.shapeOptions),this.panel.updateToolTip(this._getTooltipText().text)):this.disable(),void 0)},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(t){var e=t.layerPoint,i=t.latlng;this._currentLatLng=i,this._updateGuide(e),L.DomEvent.preventDefault(t.originalEvent)},_onClick:function(t){var e=t.latlng||t.target.getLatLng();this.addVertex(e)},_vertexChanged:function(t,e){this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers.length;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(){var t=this._getTooltipText().text;this._errorShown||this.panel.updateToolTip(t)},_drawGuide:function(t,e){var i,a,o,s,r=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)));for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane)),i=this.options.guidelineDistance;r>i;i+=this.options.guidelineDistance)a=i/r,o={x:Math.floor(t.x*(1-a)+a*e.x),y:Math.floor(t.y*(1-a)+a*e.y)},s=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),s.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(s,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;i>e;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,i=this.options.showLength;return 0===this._markers.length?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=i?this._getMeasurementString():"",t=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var i,a,o=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=o-(e?2:1),a=t.distanceTo(this._markers[i].getLatLng()),this._measurementRunningTotal+=a*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=this._measurementRunningTotal+e.distanceTo(i),L.GeometryUtil.readableDistance(t,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0,this.panel.updateToolTip(this.options.drawError.message),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this.panel.updateToolTip(this._getTooltipText().text),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);this.defaultProperties&&t.setProperties(this.defaultProperties).draw(),this.globalDrawLayer.addLayer(t),this.drawLayer.addLayer(t)},save:function(){var t=this,e=new L.LayerGroup;this.globalDrawLayer.eachLayer(function(t){var i=!1;t instanceof L.FeatureGroup&&(t.eachLayer(function(t){t.edited&&(i=!0)}),t.edited=i),t.edited&&(t.saveId&&e.addLayer(t),t.edited=!1)}),this._map.fire("draw:edited",{layers:e}),this.drawLayer.eachLayer(function(e){L.Draw.Feature.prototype._fireCreatedEvent.call(t,e),t.globalDrawLayer.removeLayer(e)}),this.drawLayer.clearLayers(),this._uneditedLayerProps={}},cancel:function(){var t=this;this.drawLayer.eachLayer(function(e){t.globalDrawLayer.removeLayer(e)}),this.drawLayer.clearLayers(),this.revertLayers(),this._uneditedLayerProps={},this.backup()},revertLayers:function(){this.globalDrawLayer.eachLayer(function(t){t instanceof L.Polyline&&!(t instanceof L.Polygon)?(this._revertLayer(t),t.editing.updateMarkers()):t instanceof L.MultiPolyline&&(this._revertLayer(t),t.eachLayer(function(t){t.editing.updateMarkers()}))},this)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0}},initialize:function(t,e,i,a){L.Draw.Polyline.prototype.initialize.call(this,t,e,i,a),this.type=L.Draw.Polygon.TYPE,this.defaultProperties=a&&a.polygon},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this)},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?t=L.drawLocal.draw.handlers.polygon.tooltip.cont:(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexAdded:function(){if(!this.options.allowIntersection&&this.options.showArea){var t=this._poly.getLatLngs();this._area=L.GeometryUtil.geodesicArea(t)}},_cleanUpShape:function(){var t=this._markers.length;t>0&&this._markers[0].off("click",this._finishShape,this)},revertLayers:function(){this.globalDrawLayer.eachLayer(function(t){t instanceof L.Polygon?(this._revertLayer(t),t.editing.updateMarkers()):t instanceof L.MultiPolygon&&(this._revertLayer(t),t.eachLayer(function(t){t.editing.updateMarkers()}))},this)}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._container.style.cursor="crosshair",this.panel.show(!0),this.panel.updateToolTip(this._initialLabelText),this._map.on("click",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._container.style.cursor="",this.panel.hide(),this._map.off("click",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_onMouseDown:function(t){return this._isDrawing?(this._shape&&this._fireCreatedEvent(),this.options.repeatMode?(this._map&&this._shape&&(this._map.removeLayer(this._shape),delete this._shape),this.panel.updateToolTip(this._initialLabelText),this._isDrawing=!1):this.disable(),void 0):(this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.preventDefault(t.originalEvent),this.panel.updateToolTip(this._endLabelText),void 0)},_onMouseMove:function(t){var e=t.latlng;this._isDrawing&&this._drawShape(e)}}),L.ViewMarker=L.Marker.extend({}),L.ViewMarker.defaultOptions={color:"#555",weight:2,opacity:.5,dashArray:"5, 5",fill:!1,fillColor:null,fillOpacity:.2,clickable:!1},L.ViewMarker.prefIcon=L.divIcon({className:"view-button view-preference"}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0}},initialize:function(t,e,i,a){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,this.viewLayer=i,this.rectangleLayer=a,this._deletedLayers=L.layerGroup(),this.newViews=L.layerGroup(),this.panel=e.panel,L.Draw.SimpleShape.prototype.initialize.call(this,t,e);var o=this;t.on("createRectangle",function(t){var e=t.llstart,i=t.llend;o.addHooks(),o._startLatLng=e,o._drawShape(i),o._fireCreatedEvent(t),o.removeHooks()}),t.on("viewFocus",function(t){o._isDrawing||(o.enable(),o._onClick(t))})},addHooks:function(){L.Draw.SimpleShape.prototype.addHooks.call(this),this._map&&(this.backup(),this.rectangleLayer.on("layeradd",this._backupLayer,this),this._map.on("click editstart",this._blur,this),this._map.on("delete",this._remove,this))},backup:function(){this.rectangleLayer.eachLayer(this._backupLayer,this)},removeHooks:function(){L.Draw.SimpleShape.prototype.removeHooks.call(this),this._map&&(this._map.off("delete",this._remove,this),this._map.off("click editstart",this._blur,this),this._coordsMarker&&(this._map.removeLayer(this._coordsMarker),this._coordsMarker=null),this.focused&&(L.DomUtil.removeClass(this.focused._icon,"active"),this.focused._rectangle.setStyle(L.ViewMarker.defaultOptions),this.panel.blurView(),this.focused=null),this.rectangleLayer.off("layeradd",this._backupLayer,this),this.save(!0))},_blur:function(){if(this.focused){this._container.style.cursor="crosshair",L.DomUtil.removeClass(this.focused._icon,"active"),this.focused._rectangle.setStyle(L.ViewMarker.defaultOptions),this.panel.blurView(),this.focused=null;var t=this;setTimeout(function(){t._map.on("click",t._onMouseDown,t)},0)}},_onClick:function(t){var e=t.layer;this.focused!==e&&(this._container.style.cursor="",this.focused&&(L.DomUtil.removeClass(this.focused._icon,"active"),this.focused._rectangle.setStyle(L.ViewMarker.defaultOptions),this.panel.blurView()),this.focused=e,e._rectangle.setStyle({opacity:1,color:"#000000"}),L.DomUtil.addClass(this.focused._icon,"active"),this.panel.focusView(e),this._map.off("click",this._onMouseDown,this))},_remove:function(){var t=this.focused;this._blur(),this.viewLayer.removeLayer(t),this.rectangleLayer.removeLayer(t._rectangle),this._deletedLayers.addLayer(t)},deleteLastVertex:function(){this._isDrawing&&(this._map&&this._shape&&(this._map.removeLayer(this._shape),delete this._shape,this._coordsMarker&&(this._map.removeLayer(this._coordsMarker),this._coordsMarker=null)),this.panel.updateToolTip(this._initialLabelText),this._isDrawing=!1)},cancel:function(){var t=this;this.focused&&(this.focused._rectangle.edited||this.newViews.hasLayer(this.focused._rectangle))&&this._blur(),this._deletedLayers.eachLayer(function(e){t.viewLayer.addLayer(e),t.rectangleLayer.addLayer(e._rectangle)}),this._deletedLayers.clearLayers(),this.newViews.eachLayer(function(e){t.rectangleLayer.removeLayer(e),t.viewLayer.removeLayer(e._icon)}),this.newViews.clearLayers(),this.rectangleLayer.eachLayer(function(e){t._revertLayer(e),e.editing.updateMarkers()})},save:function(t){var e=this;this._deletedLayers.eachLayer(function(t){e.newViews.hasLayer(t._rectangle)&&(e.newViews.removeLayer(t._rectangle),e._deletedLayers.removeLayer(t))}),this.newViews.eachLayer(function(t){L.Draw.SimpleShape.prototype._fireCreatedEvent.call(e,t),t.edited=!1}),this.newViews.clearLayers(),this._map.fire("draw:deleted",{layers:this._deletedLayers}),this._deletedLayers.clearLayers();var i=new L.LayerGroup;this.rectangleLayer.eachLayer(function(t){t.edited&&(i.addLayer(t),t.edited=!1)}),this._map.fire("draw:edited",{layers:i}),t!==!0&&(this._uneditedLayerProps={},this.backup())},_drawShape:function(t){var e=this._map._roundLatlng(this._startLatLng,t,10,40)[0];this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,e)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,e),this.options.shapeOptions),this._map.addLayer(this._shape));var i=this._shape.getBounds(),a=this._map.project(i._northEast),o=this._map.project(i._southWest),s=this._map.getZoom(),r=Math.round(a.x-o.x),n=Math.round(o.y-a.y),l=40===r&&40===n,h=l?"Plein écran":r+"x"+n,d=L.divIcon({html:'<div class="coords-icon"> <span class="leaflet-draw-tooltip-single">'+h+" z="+s+"</span></div>",iconSize:L.Point(40,40),iconAnchor:[120,-25]}),c=[i._southWest.lat,i._northEast.lng];this._coordsMarker?(this._coordsMarker.setIcon(d),this._coordsMarker.setLatLng(c)):(this._coordsMarker=new L.ViewMarker(c,{icon:d}),this._coordsMarker.setZIndexOffset(100002),this._map.addLayer(this._coordsMarker),this._coordsMarker.zoom=s,this._coordsMarker.minzoom=Math.max(s-2,this._map.getMinZoom()),this._coordsMarker.maxzoom=Math.min(s+2,this._map.getMaxZoom())),this._coordsMarker.width=r,this._coordsMarker.height=n,this._coordsMarker.fullscreen=l},_fireCreatedEvent:function(t){var e=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);this._coordsMarker._rectangle=e,e._icon=this._coordsMarker,t&&(this._coordsMarker.saveId=t.saveId,this._coordsMarker.cb=t.cb,this._coordsMarker.osmId=t.osmId);var i=this._map.getZoom();e._zoom=i,this._coordsMarker._title="",this._coordsMarker._interface="leaflet";var a=L.divIcon({className:"view-button view-preference"});this._coordsMarker.setIcon(a),this._map.removeLayer(this._coordsMarker),this.viewLayer.addLayer(this._coordsMarker),this.rectangleLayer.addLayer(e),this._coordsMarker=null,this.newViews.addLayer(e);var o=this;t||setTimeout(function(){o._map.fire("viewFocus",{layer:e._icon})},0)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,a=this.options.showRadius,o=this.options.metric;this._tooltip.updatePosition(i),this._isDrawing&&(this._drawShape(i),e=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:a?"Radius: "+L.GeometryUtil.readableDistance(e,o):""}))}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e,i,a){this.type=L.Draw.Marker.TYPE,this.drawLayer=L.featureGroup(),this.editedLayers=L.layerGroup(),this.globalDrawLayer=i,this.defaultProperties=a&&a.marker,this.panel=e.panel,L.Draw.Feature.prototype.initialize.call(this,t,e)},_enableDrag:function(t){var e=t.layer||t;e instanceof L.Marker&&(e.dragging.enable(),e.on("dragstart",this._backupLayer,this),e.on("dragend",this.onDragEnd,this))},_disableDrag:function(t){var e=t.layer||t;e instanceof L.Marker&&(e.dragging.disable(),e.off("dragend",this.onDragEnd,this),e.off("dragstart",this._backupLayer,this))},onDragEnd:function(t){var e=t.target;this.editedLayers.addLayer(e),e.edited=!0},revertLayers:function(){this.globalDrawLayer.eachLayer(function(t){t instanceof L.Marker&&this._revertLayer(t)},this)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this.panel.show(),this.panel.updateToolTip(L.drawLocal.draw.handlers.marker.tooltip.start),this._map._container.style.cursor="crosshair",this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this),this.drawLayer.addTo(this._map),this.globalDrawLayer.eachLayer(this._enableDrag,this),this.globalDrawLayer.on("layeradd",this._enableDrag,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this.panel.hide(),this.globalDrawLayer.eachLayer(this._disableDrag,this),this.globalDrawLayer.off("layeradd",this._enableDrag,this),this._map._container.style.cursor=null,this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this),this.save(),this._map.removeLayer(this.drawLayer))},_onMouseMove:function(t){this.latlng=t.latlng},_onClick:function(){this._fireCreatedEvent(),this.options.repeatMode||this.disable()},cancel:function(){this.drawLayer.clearLayers(),this.revertLayers()},save:function(){var t=this;this.drawLayer.eachLayer(function(e){L.Draw.Feature.prototype._fireCreatedEvent.call(t,e)}),this._map.fire("draw:edited",{layers:this.editedLayers}),this.editedLayers.eachLayer(function(t){delete t.edited}),this.drawLayer.clearLayers(),this.editedLayers.clearLayers(),this._uneditedLayerProps={}},_fireCreatedEvent:function(){var t=new L.Marker(this.latlng);this.defaultProperties&&t.setProperties(this.defaultProperties).draw(),this.drawLayer.addLayer(t),t.dragging.enable()}}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t,e){this._poly=t,L.setOptions(this,e)},addHooks:function(){this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){this._poly._map&&(this._poly._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,a,o=this._poly._latlngs;for(t=0,i=o.length;i>t;t++)a=this._createMarker(o[t],t),a.on("click",this._onMarkerClick,this),this._markers.push(a);var s,r;for(t=0,e=i-1;i>t;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(s=this._markers[e],r=this._markers[t],this._createMiddleMarker(s,r),this._updatePrevNext(s,r))},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("drag",this._onMarkerDrag,this),i.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(i),i},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._poly.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit")},_onMarkerDrag:function(t){var e=t.target;L.extend(e._origLatLng,e._latlng),e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly.redraw()},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._poly._latlngs.length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,a,o,s=this._getMiddleLatLng(t,e),r=this._createMarker(s);r.setOpacity(.6),t._middleRight=e._middleLeft=r,a=function(){var a=e._index;r._index=a,r.off("click",i,this).on("click",this._onMarkerClick,this),s.lat=r.getLatLng().lat,s.lng=r.getLatLng().lng,this._poly.spliceLatLngs(a,0,s),this._markers.splice(a,0,r),r.setOpacity(1),this._updateIndexes(a,1),e._index++,this._updatePrevNext(t,r),this._updatePrevNext(r,e),this._poly.fire("editstart")},o=function(){r.off("dragstart",a,this),r.off("dragend",o,this),this._createMiddleMarker(t,r),this._createMiddleMarker(r,e)},i=function(){a.call(this),o.call(this),this._fireEdit()},r.on("click",i,this).on("dragstart",a,this).on("dragend",o,this),this._markerGroup.addLayer(r)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,a=i.project(t.getLatLng()),o=i.project(e.getLatLng());return i.unproject(a._add(o)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},initialize:function(t,e){this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){this._shape._map&&(this._map=this._shape._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){if(this._shape._map){this._unbindMarker(this._moveMarker);for(var t=0,e=this._resizeMarkers.length;e>t;t++)this._unbindMarker(this._resizeMarkers[t]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(t){var e=t.target;e.setOpacity(0),this._shape.fire("editstart"),this._map.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw()},_onMarkerDragEnd:function(t){var e=t.target;e.setOpacity(1),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_zoomToResize:function(t){var e=t.target,i=e.getLatLng(),a=this._shape._zoom,o=this._map;setTimeout(function(){o.setZoomAround(i,a)},0)},addHooks:function(){L.Edit.SimpleShape.prototype.addHooks.call(this);for(var t=0,e=this._resizeMarkers.length;e>t;t++){var i=this._resizeMarkers[t];i.on("mousedown",this._zoomToResize,this)}},removeHooks:function(){for(var t=0,e=this._resizeMarkers.length;e>t;t++){var i=this._resizeMarkers[t];i.off("mousedown",this._zoomToResize,this)}L.Edit.SimpleShape.prototype.removeHooks.call(this)},_createMoveMarker:function(){var t=this._shape.getBounds(),e=this._map.getRealCenter(t);this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;i>e;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),i=t.target,a=i._cornerIndex;
this._oppositeCorner=e[(a+2)%4],this._toggleCornerMarkers(0,a)},_onMarkerDragEnd:function(t){var e,i,a=t.target;a===this._moveMarker&&(e=this._shape.getBounds(),i=this._map.getRealCenter(e),a.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t);var o=L.divIcon({className:"view-button view-preference"});this._shape._icon.setIcon(o)},_move:function(t){for(var e,i=this._shape.getLatLngs(),a=this._shape.getBounds(),o=[],s=this._map.project(a._northEast),r=this._map.project(a._southWest),n=new L.Point((s.x+r.x)/2,(s.y+r.y)/2),l=this._map.project(t),h=0,d=i.length;d>h;h++){var c=this._map.project(i[h]);e=[c.x-n.x,c.y-n.y],o.push(this._map.unproject([l.x+e[0],l.y+e[1]]))}this._shape.setLatLngs(o),a=this._shape.getBounds();var _=[a._southWest.lat,a._northEast.lng];this._shape._icon.setLatLng(_),this._repositionCornerMarkers()},_resize:function(t){var e=this._map._roundLatlng(this._moveMarker.getLatLng(),t,5,20);this._shape.setBounds(L.latLngBounds(e[0],e[1]));var i=this._shape._zoom,a=this._shape.getBounds(),o=this._map.project(a._northEast,i),s=this._map.project(a._southWest,i),r=Math.round(o.x-s.x),n=Math.round(s.y-o.y),l=[a._southWest.lat,a._northEast.lng];this._shape._icon.setLatLng(l);var h=40===r&&40===n,d=h?"Plein écran":r+"x"+n,c=L.divIcon({html:d+" z="+i,iconAnchor:[110,-10],className:"coords-icon"});this._shape._icon.setIcon(c),this._shape._icon.width=r,this._shape._icon.height=n,this._shape._icon.fullscreen=h,a=this._shape.getBounds(),this._moveMarker.setLatLng(this._map.getRealCenter(a))},_getCorners:function(){var t=this._shape.getBounds(),e=t.getNorthWest(),i=t.getNorthEast(),a=t.getSouthEast(),o=t.getSouthWest();return[e,i,a,o]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_move:function(t){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e),this._shape.setLatLng(t)},_resize:function(t){var e=this._moveMarker.getLatLng(),i=e.distanceTo(t);this._shape.setRadius(i)}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,a=t.length;a>i;i++)e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,a=t.length,o=0,s=L.LatLng.DEG_TO_RAD;if(a>2){for(var r=0;a>r;r++)e=t[r],i=t[(r+1)%a],o+=(i.lng-e.lng)*s*(2+Math.sin(e.lat*s)+Math.sin(i.lat*s));o=6378137*o*6378137/2}return Math.abs(o)},readableArea:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" ha":t.toFixed(2)+" m&sup2;":(t*=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},readableDistance:function(t,e){var i;return e?i=t>1e3?(t/1e3).toFixed(2)+" km":Math.ceil(t)+" m":(t*=1.09361,i=t>1760?(t/1760).toFixed(2)+" miles":Math.ceil(t)+" yd"),i}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,a){return this._checkCounterclockwise(t,i,a)!==this._checkCounterclockwise(e,i,a)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,a)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,a=this._originalPoints,o=a?a.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=o-1;t>=3;t--)if(e=a[t-1],i=a[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(t),e):!1},newPointIntersects:function(t,e){var i=this._originalPoints,a=i?i.length:0,o=i?i[a-1]:null,s=a-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(o,t,s,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._originalPoints,i=e?e.length:0;return i+=t||0,!this._originalPoints||3>=i},_lineSegmentsIntersectsRange:function(t,e,i,a){var o,s,r=this._originalPoints;a=a||0;for(var n=i;n>a;n--)if(o=r[n-1],s=r[n],L.LineUtil.segmentsIntersect(t,e,o,s))return!0;return!1}}),L.Polygon.include({intersects:function(){var t,e,i,a,o,s=this._originalPoints;return this._tooFewPointsForIntersection()?!1:(t=L.Polyline.prototype.intersects.call(this))?!0:(e=s.length,i=s[0],a=s[e-1],o=e-2,this._lineSegmentsIntersectsRange(a,i,o,1))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,t);var e,i;this._toolbars={},L.EditToolbar&&this.options.edit&&(i=new L.EditToolbar(this.options.edit),e=L.stamp(i),this._toolbars[e]=i,this._toolbars[e].on("enable",this._toolbarEnabled,this)),L.DrawToolbar&&this.options.draw&&(i=new L.DrawToolbar(this.options.draw),e=L.stamp(i),this._toolbars[e]=i,this._toolbars[e].on("enable",this._toolbarEnabled,this)),L.ViewToolbar&&this.options.draw&&(i=new L.ViewToolbar(this.options.draw),e=L.stamp(i),this._toolbars[e]=i,this._toolbars[e].on("enable",this._toolbarEnabled,this)),L.SearchToolbar&&this.options.search&&(i=new L.SearchToolbar(this.options.search),e=L.stamp(i),this._toolbars[e]=i,this._toolbars[e].on("enable",this._toolbarEnabled,this))},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),a=!1,o="leaflet-draw-toolbar-top";for(var s in this._toolbars)this._toolbars.hasOwnProperty(s)&&(e=this._toolbars[s].addToolbar(t),e&&(a||(L.DomUtil.hasClass(e,o)||L.DomUtil.addClass(e.childNodes[0],o),a=!0),i.appendChild(e)));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=""+L.stamp(t.target);for(var i in this._toolbars)this._toolbars.hasOwnProperty(i)&&i!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),a=0,o=this._toolbarClass||"",s=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<s.length;e++)s[e].enabled&&this._initModeHandler(s[e].handler,this._toolbarContainer,a++,o,s[e].title);return a?(this._lastButtonIndex=--a,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i):void 0},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;i>e;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,a,o){var s=t.type;this._modes[s]={},this._modes[s].handler=t,this._modes[s].button=this._createButton({title:o,className:a+"-"+s,container:e,callback:this._modes[s].handler.enable,context:this._modes[s].handler}),this._modes[s].buttonIndex=i,this._modes[s].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,a,o,s=this._actionsContainer,r=this.getActions(t),n=r.length;for(i=0,a=this._actionButtons.length;a>i;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];s.firstChild;)s.removeChild(s.firstChild);for(var l=0;n>l;l++)"enabled"in r[l]&&!r[l].enabled||(e=L.DomUtil.create("li","",s),o=this._createButton({title:r[l].title,text:r[l].text,container:e,callback:r[l].callback,context:r[l].context}),this._actionButtons.push({button:o,callback:r[l].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}}),L.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(i.style.visibility="inherit",L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this}}),L.DrawToolbar=L.Toolbar.extend({options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker,e,this.options.defaultProperties),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline,e,this.options.defaultProperties),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon,e,this.options.defaultProperties),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.cicle),title:L.drawLocal.draw.toolbar.buttons.circle}]},getActions:function(){return[]},cancel:function(){this._activeMode.handler.cancel()},_save:function(){this._activeMode.handler.save()},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.ViewToolbar=L.DrawToolbar.extend({getModeHandlers:function(t){var e=this.options.viewLayer,i=this.options.rectangleLayer;return[{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle,e,i),title:L.drawLocal.draw.toolbar.buttons.rectangle}]}}),L.EditToolbar=L.Toolbar.extend({options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:.6,dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1}},remove:{},featureGroup:null},initialize:function(t){t.edit&&("undefined"==typeof t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit=L.extend({},this.options.edit,t.edit)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),t.style&&(t.style=L.extend({},this.options.style,t.style)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.navigate,handler:new L.EditToolbar.Navigate(t,{}),title:L.drawLocal.edit.toolbar.buttons.navigate},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove},{enabled:this.options.style,handler:new L.EditToolbar.Style(t,{featureGroup:e,panel:this.options.style.panel}),title:L.drawLocal.edit.toolbar.buttons.style}]},getActions:function(){return[]},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);if(this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),this._modes.navigate){var i=this;t.on("navigation",function(){i._modes.navigate.handler.enable()})}return e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},cancel:function(){this.enabled()&&this._activeMode.handler.revertLayers()},disable:function(){this.enabled()&&(this._activeMode.handler.save(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save()},_checkDisabled:function(){var t,e=!0;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,e?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",e?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,e?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",e?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled)),this.options.style&&(t=this._modes[L.EditToolbar.Style.TYPE].button,e?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",e?L.drawLocal.edit.toolbar.buttons.style:L.drawLocal.edit.toolbar.buttons.styleDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),this._selectedPathOptions=e.selectedPathOptions,this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire("draw:edited",{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?(this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())},t._icon&&(this._uneditedLayerProps[e].icon=t._icon.options.icon,this._uneditedLayerProps[e].iconLatLng=L.LatLngUtil.cloneLatLng(t._icon.getLatLng()),this._uneditedLayerProps[e].icon.width=t._icon.width,this._uneditedLayerProps[e].icon.height=t._icon.height)):this._uneditedLayerProps[e]=t instanceof L.Circle?{latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:{latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())})},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?(t.setLatLngs(this._uneditedLayerProps[e].latlngs),t._icon&&(t._icon.setIcon(this._uneditedLayerProps[e].icon),t._icon.setLatLng(this._uneditedLayerProps[e].iconLatLng),t._icon.width=this._uneditedLayerProps[e].icon.width,t._icon.height=this._uneditedLayerProps[e].icon.height)):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t.setLatLng(this._uneditedLayerProps[e].latlng))},_toggleMarkerHighlight:function(t){if(t._icon){var e=t._icon;e.style.display="none",L.DomUtil.hasClass(e,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(e,"leaflet-edit-marker-selected"),this._offsetMarker(e,-4)):(L.DomUtil.addClass(e,"leaflet-edit-marker-selected"),this._offsetMarker(e,4)),e.style.display=""}},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,a=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=a+"px"},_enableLayerEdit:function(t){var e,i=t.layer||t.target||t,a=i instanceof L.Marker;(!a||i._icon)&&(this._backupLayer(i),this._selectedPathOptions&&(e=L.Util.extend({},this._selectedPathOptions),a?this._toggleMarkerHighlight(i):(i.options.previousOptions=L.Util.extend({dashArray:null},i.options),i instanceof L.Circle||i instanceof L.Polygon||i instanceof L.Rectangle||(e.fill=!1),i.setStyle(e))),a?(i.dragging.enable(),i.on("dragend",this._onMarkerDragEnd)):i.editing.enable())},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,this._selectedPathOptions&&(e instanceof L.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof L.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this)):e.editing.disable()},_onMarkerDragEnd:function(t){var e=t.target;e.edited=!0},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return!0}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.layerGroup,this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(t){t._rectangle&&this._deletableLayers.addLayer(t._rectangle),this._deletableLayers.addLayer(t)},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(t){var e=t.layer||t.target||t;e.on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.target||t;e._rectangle&&this._deletableLayers.removeLayer(e._rectangle),this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e)},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return!0}}),L.EditToolbar.Navigate=L.Handler.extend({statics:{TYPE:"navigate"},includes:L.Mixin.Events,initialize:function(t,e){L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this.type=L.EditToolbar.Navigate.TYPE},enable:function(){this._enabled||(this.fire("enabled",{handler:this.type}),this._map.fire("draw:navigatestart",{handler:this.type}),L.Handler.prototype.enable.call(this))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:navigatestop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&t.getContainer().focus()},removeHooks:function(){},revertLayers:function(){},save:function(){}})}(window,document);